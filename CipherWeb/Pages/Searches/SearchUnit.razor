@page "/Search/Unit"

@inject NavigationManager Navigation

<CipherWeb.Pages.Forms.ResourceForm @ref="ResourcePage" Title="@NavLink.Name">
    <CipherUnitCard Title="" WithCard="false" @ref="@objectCard" ChangeUnit="ChangeUrl" ChosenUnit="@ChosenObject" SetMode="FormMode.ReadOnly" />
    <CipherObjectChangesTable ObjectChanges="@ChosenObject?.UserActions().Item1" />
</CipherWeb.Pages.Forms.ResourceForm>

@code {
    /// <summary>
    /// Page nav link.
    /// </summary>
    [Parameter]
    public MySubNavLink NavLink { get; set; } = CipherNavLinks.UnitSearch;

    /// <summary>
    /// Chosen object upon searching
    /// </summary>
    [Parameter]
    public Unit? ChosenObject { get; set; }

    /// <summary>
    /// API response to search.
    /// </summary>
    [Parameter]
    public ErrorResponse Error { get; set; } = ErrorResponse.Success;

    private CipherUnitCard objectCard = new();
    private CipherWeb.Pages.Forms.ResourceForm ResourcePage = new();

    protected override void OnInitialized()
    {
        (ChosenObject, Error) = ResourcePage.GetObjectFromUrl<Unit>(Navigation);
    }

    /// <summary>
    /// Changes URL to include the chosen-unit id, upon searching it within the page.
    /// </summary>
    public void ChangeUrl()
    {
        ChosenObject = objectCard.ChosenUnit;
        ResourcePage.ChangeUrl(Navigation, NavLink, ChosenObject?.Id);
    }
}
