@page "/Search/Vessel"

@inject NavigationManager Navigation

<CipherWeb.Pages.Forms.ResourceForm @ref="ResourcePage" Title="@NavLink.Name">
    <CipherVesselCard Title="" WithCard="false" @ref="@objectCard" ChangeVessel="ChangeUrl" ChosenVessel="@ChosenObject" SetMode="FormMode.ReadOnly" />
    <CipherObjectChangesTable ObjectChanges="@ChosenObject?.UserActions().Item1" />
</CipherWeb.Pages.Forms.ResourceForm>


@code {
    /// <summary>
    /// Page nav link.
    /// </summary>
    [Parameter]
    public MySubNavLink NavLink { get; set; } = CipherNavLinks.VesselSearch;

    /// <summary>
    /// Chosen object upon searching
    /// </summary>
    [Parameter]
    public Vessel? ChosenObject { get; set; }

    /// <summary>
    /// API response to search.
    /// </summary>
    [Parameter]
    public ErrorResponse Error { get; set; } = ErrorResponse.Success;

    private CipherVesselCard objectCard = new();
    private CipherWeb.Pages.Forms.ResourceForm ResourcePage = new();

    protected override void OnInitialized()
    {
        (ChosenObject, Error) = ResourcePage.GetObjectFromUrl<Vessel>(Navigation);
    }

    /// <summary>
    /// Changes URL to include the chosen-unit id, upon searching it within the page.
    /// </summary>
    public void ChangeUrl()
    {
        ChosenObject = objectCard.ChosenVessel;
        ResourcePage.ChangeUrl(Navigation, NavLink, ChosenObject?.Id);
    }
}
