@page "/Search/Advanced"

<PageTitle>חיפוש מתקדם</PageTitle>

<CipherComponentCard Title="נא לבחור אובייקטים לתצוגה" ContentJustify="center" ContentDisplay="flex">
    <RadzenSelectBar @bind-Value="@objectId" Multiple="false" TValue="int">
        <Items>
            @foreach (string objType in objectTypes)
            {
                <RadzenSelectBarItem Text="@objType" Value="@objectTypes.IndexOf(objType)" />
            }
        </Items>
    </RadzenSelectBar>
</CipherComponentCard>
@RenderCipherDataFilter(objectId)

@code {
    [Parameter]
    public int objectId { get; set; }

    [Parameter]
    public List<string> objectTypes { get; set; } =
    new List<string> { "תעודות", "כלים", "מערכות", "תנועות", "תהליכים", "סוגים" };


    string width = "width: 200px";

    private ErrorResponse error = ErrorResponse.Success;

    private CipherDataFilter_WithDataGrid<Category> CategoryFilter = new();
    private CipherDataFilter_WithDataGrid<Event> EventFilter = new();
    private CipherDataFilter_WithDataGrid<Package> PackageFilter = new();
    private CipherDataFilter_WithDataGrid<Process> ProcessFilter = new();
    private CipherDataFilter_WithDataGrid<StorageSystem> SystemFilter = new();
    private CipherDataFilter_WithDataGrid<Vessel> VesselFilter = new();

    private List<Package> packs = new List<Package>();
    private List<Vessel> vessels = new List<Vessel>();
    private List<StorageSystem> systems = new List<StorageSystem>();
    private List<Event> events = new List<Event>();
    private List<Process> procs = new List<Process>();
    private List<Category> categories = new List<Category>();

    protected override void OnInitialized()
    {
        (packs, error) = CachedData.AllPackages;
        (vessels, error) = CachedData.AllVessels;
        (systems, error) = CachedData.AllSystems;
        (events, error) = CachedData.AllEvents;
        (procs, error) = CachedData.AllProcesses;
        (categories, error) = CachedData.AllCategories;
    }

    private RenderFragment? RenderCipherDataFilter(int objectId) => objectId switch
    {
        0 => @<CipherDataFilter_WithDataGrid @ref=PackageFilter Cipher_TItem="Package" Title="סינון נתונים" GeneralDataSource="@packs" />,
        1 => @<CipherDataFilter_WithDataGrid @ref=VesselFilter Cipher_TItem="Vessel" Title="סינון נתונים" GeneralDataSource="@vessels" />,
        2 => @<CipherDataFilter_WithDataGrid @ref=SystemFilter Cipher_TItem="StorageSystem" Title="סינון נתונים" GeneralDataSource="@systems" />,
        3 => @<CipherDataFilter_WithDataGrid @ref=EventFilter Cipher_TItem="Event" Title="סינון נתונים" GeneralDataSource="@events" />,
        4 => @<CipherDataFilter_WithDataGrid @ref=ProcessFilter Cipher_TItem="Process" Title="סינון נתונים" GeneralDataSource="@procs" />,
        5 => @<CipherDataFilter_WithDataGrid @ref=CategoryFilter Cipher_TItem="Category" Title="סינון נתונים" GeneralDataSource="@categories" />,
        _ => null
    };

    public IEnumerable<object>? GetFilteredValues() => objectId switch
    {
        0 => PackageFilter.FilteredRows,
        1 => VesselFilter.FilteredRows,
        2 => SystemFilter.FilteredRows,
        3 => EventFilter.FilteredRows,
        4 => ProcessFilter.FilteredRows,
        5 => CategoryFilter.FilteredRows,
        _ => null
    };
}
