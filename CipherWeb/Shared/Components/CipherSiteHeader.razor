@using System.Text
@using System.Reflection

@inject DialogService DialogService
@inject NavigationManager NavigationManager

<RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Center"
             AlignItems="AlignItems.Center" Gap="1rem" Style="@($"width:{Header_Width}")">
    @* -- LOGO BLOCK -- *@
    <RadzenLink Path="" Text="מסך הבית" Style="@($"width:{Logo_Width}")">
        <CipherLogo />
    </RadzenLink>

    @* -- SEARCH BLOCK -- *@
    <CipherSearchRow LabelText="חיפוש" Width="@Search_Width"></CipherSearchRow>

    @* -- ACCOUNT BLOCK --*@
    <RadzenCard Variant="Variant.Text" Style="@($"{AccountStyle()}; width:{Account_Width};")">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center">
            <RadzenLink Path="Personal" Text="אזור אישי">
                <CipherAccountImage />
            </RadzenLink>
            <RadzenStack AlignItems="AlignItems.Start" JustifyContent="JustifyContent.Center" Gap="0.2rem">
                <CipherText Text="@Constants.SetUser.FullName()" TextAlign="TextAlign.Right" TextColor="var(--cipher-header-color)" TextStyle="TextStyle.H6" />
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Center" AlignItems="AlignItems.Start" Gap="0.3rem">
                    <CipherButton Icon="@Icons.Account" Size="ButtonSize.ExtraSmall" ColorStyle="ButtonStyle.Primary" ColorShade="Shade.Darker" HelpText="שינוי תצוגה"
                                  Click="@(args => ChangeRole())" Text="@($"מוצג כמסך של {Roles.CurrnetRole}")" Variant="Variant.Outlined"
                                  Width="100%" MaxWidth="180px" ButtonTextAlign="right" HelpTextPosition="TooltipPosition.Bottom" />

                    @* -- FAST ACTIONS -- *@
                    <CipherNavButton Icon="@Icons.Settings" HelpText="הגדרות" Size="ButtonSize.ExtraSmall" Variant="Variant.Outlined" ColorShade="Shade.Darker"
                                     Path="/Settings" HelpTextPosition="TooltipPosition.Bottom" />
                    <CipherNavButton Icon="@Icons.Help" HelpText="הסברים ותמיכה" Size="ButtonSize.ExtraSmall" Variant="Variant.Outlined" ColorShade="Shade.Darker"
                                     Path="/Information" HelpTextPosition="TooltipPosition.Bottom" />
                </RadzenStack>
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>
</RadzenStack>

@code {
    // HEADER PROPERTIES

    [Parameter]
    public string Header_Padding { get; set; } = "0";

    [Parameter]
    public string Header_AlignText { get; set; } = "center";

    [Parameter]
    public string Header_Width { get; set; } = "100%";

    [Parameter]
    public string Header_Position { get; set; } = "fixed";

    [Parameter]
    public string Header_Top { get; set; } = "0";

    // LOGO PROPERTIES

    [Parameter]
    public string Logo_Width { get; set; } = "25%";

    // ACCOUNT PROPERTIES

    [Parameter]
    public string Account_Width { get; set; } = "40%";

    [Parameter]
    public string Account_Padding { get; set; } = "0";

    [Parameter]
    public int ZIndex { get; set; } = 100;

    // SEARCH ID

    [Parameter]
    public string Search_Width { get; set; } = "30%";

    public string NewRole;

    public async Task ChangeRole()
    {
        var result = await DialogService.OpenAsync("", ds =>
    @<RadzenStack Gap="1rem" Style="text-align:right;" dir="rtl" AlignItems="AlignItems.Center">
            <CipherAutoComplete Icon="@Icons.Account_Old" Label="תצוגה נוכחית" Value="@Roles.CurrnetRole" Style="width: 200px" Disabled="true"/>
        <CipherAutoComplete Icon="@Icons.Account_New" Label="תצוגה חדשה" Style="width: 200px" @bind-Value=@NewRole Data="@Roles.Get()" />


            <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenStack Orientation="Orientation.Horizontal">
                            <CipherButton Icon="@Icons.Done" Text="אישור" Click="() => ds.Close(ChangeRoleView())" ColorStyle="ButtonStyle.Success" ColorShade="Shade.Default" Width="100px" />
                            <CipherButton Icon="@Icons.Cancel" Text="ביטול" Click="() => ds.Close(false)" ColorStyle="ButtonStyle.Danger" ColorShade="Shade.Dark" Width="100px" />
                
            </RadzenStack>
            
        </RadzenStack>
    </RadzenStack>

    );
    }

    public bool ChangeRoleView()
    {
        Roles.CurrnetRole = NewRole;
        return true;
    }

    public string AccountStyle()
    {
        return $@"
                padding: {Account_Padding};
                width: 100%;
                ";
    }
}