@using Radzen
@using CipherData.Models
@using CipherWeb.Data
@using CipherWeb.Shared.Components
@using CipherWeb.Shared.Components.Buttons
@using CipherWeb.Shared.Components.CipherSpecific

@inherits CipherComponentCard

@inject ICipherInfo _db

<CipherComponentCard Title="גאנט תהליכים" MaxWidth="@MaxWidth" Width="@Width">
    <Buttons>
        <CipherButton Icon="@Icons.Table" HelpText="הצגה כטבלה" Size="ButtonSize.Medium"
                      Variant="Variant.Outlined" ColorShade="Shade.Darker" Click="@TableView" />
        <CipherButton Icon="@Icons.Calendar" HelpText="הצגה כלוח שנה"
                      Size="ButtonSize.Medium" Variant="Variant.Outlined"
                      Click="@CalendarView" />
        <CipherButton Icon="@Icons.Edit" HelpText="בחירת תהליכים לתצוגה"
                      Size="ButtonSize.Medium" Variant="Variant.Outlined" />
        <CipherExcelButton FileName="events" Data="@events" />
        <CipherPDFButton />
    </Buttons>
    <ChildContent>
        @if (SetView == View.Table)
        {
            <CipherEventsTable Title="" AllowFilter="false" AllowGroup="false" WithCard="false" WithButtons="false" />
        }
        else
        {
            <CipherScheduler Height="@EventsHeight" />
        }
    </ChildContent>
</CipherComponentCard>

@code {
    [Parameter]
    public Role SetRole { get; set; } = Role.Manager;

    [Parameter]
    public string EventsHeight { get; set; } = "600px";

    // initial view of the scheduler (upon entry)
    [Parameter]
    public View SetView { get; set; } = View.Calendar;

    public enum View
    {
        Calendar,
        Table
    }

    public enum Role
    {
        Manager,
        Engineer,
        Admin,
        Authorizer
    }

    List<Event> events = new List<Event>();

    protected override async Task OnInitializedAsync()
    {
        events = await _db.GetEvents();

        if (SetRole == Role.Manager)
        {
            SetView = View.Calendar;
        }
        else
        {
            SetView = View.Table;
        }
    }

    private void TableView()
    {
        SetView = View.Table;
    }

    private void CalendarView()
    {
        SetView = View.Calendar;
    }
}